<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 励志图文排版助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background: #f8fafc; color: #1e293b; }
        .wx-article { line-height: 1.8; letter-spacing: 0.1em; color: #3f3f3f; font-size: 16px; }
        .phone-shell { width: 390px; height: 844px; background: white; border: 12px solid #1a1a1a; border-radius: 48px; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.3); position: relative; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-content { animation: slideUp 0.8s ease forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [loading, setLoading] = useState(false);
            const [workerUrl, setWorkerUrl] = useState(localStorage.getItem('worker_url') || '');
            const editorRef = useRef(null);

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [loading]);

            const generateArtical = async () => {
                if (!workerUrl) return alert('请先配置 Worker URL');
                setLoading(true);
                try {
                    const res = await fetch(`${workerUrl.replace(/\/$/, '')}/api/generate_article`);
                    const json = await res.json();
                    
                    const html = `
                        <section style="padding: 20px 0;">
                            <!-- 顶部装饰 -->
                            <section style="text-align: center; margin-bottom: 40px;">
                                <p style="font-size: 12px; color: #6366f1; letter-spacing: 4px; margin-bottom: 10px;">MORNING INSPIRATION</p>
                                <h1 style="font-family: 'Noto Serif SC'; font-weight: bold; font-size: 24px; color: #1e293b; line-height: 1.4;">${json.title}</h1>
                                <section style="width: 40px; height: 2px; background: #6366f1; margin: 20px auto;"></section>
                            </section>

                            ${json.data.map((item, idx) => `
                                <section style="margin-bottom: 50px;">
                                    <!-- 段落标题标识 -->
                                    <section style="display: flex; align-items: center; margin-bottom: 20px;">
                                        <section style="background: #6366f1; color: #fff; width: 24px; height: 24px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">${idx + 1}</section>
                                        <section style="height: 1px; flex: 1; background: #f1f5f9; margin-left: 10px;"></section>
                                    </section>
                                    
                                    <!-- 正文内容 -->
                                    <section style="line-height: 2; text-align: justify; margin-bottom: 25px; color: #334155;">
                                        ${item.text.replace(/\n/g, '<br/>')}
                                    </section>

                                    <!-- 插图设计 -->
                                    <section style="margin: 30px 0; position: relative;">
                                        <img src="https://images.unsplash.com/photo-${Math.random().toString(36).substr(2, 9)}?auto=format&fit=crop&w=800&q=80&sig=${idx}&${item.keyword}" 
                                             style="width: 100%; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: block;" 
                                             alt="励志配图" />
                                        <section style="position: absolute; bottom: -10px; right: 20px; background: #fff; padding: 5px 15px; border-radius: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); font-size: 10px; color: #94a3b8; font-style: italic;">
                                            Focus on ${item.keyword}
                                        </section>
                                    </section>
                                </section>
                            `).join('')}

                            <!-- 底部封底 -->
                            <section style="text-align: center; margin-top: 60px; padding: 40px 0; border-top: 1px dashed #e2e8f0;">
                                <p style="font-family: 'Noto Serif SC'; color: #6366f1; font-size: 18px; margin-bottom: 10px;">愿你历经千帆，归来仍是少年</p>
                                <p style="font-size: 12px; color: #94a3b8; letter-spacing: 2px;">—— 点击上方关注，每天一点正能量 ——</p>
                            </section>
                        </section>
                    `;
                    
                    editorRef.current.innerHTML = html;
                } catch (e) {
                    alert('生成失败: ' + e.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleCopy = () => {
                const range = document.createRange();
                range.selectNode(editorRef.current);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand('copy');
                alert('✨ 完美复制！请到公众号后台粘贴。');
            };

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* 控制栏 */}
                    <div className="w-80 bg-white border-r flex flex-col p-8 shrink-0 shadow-lg z-10">
                        <div className="flex items-center gap-2 mb-10">
                            <div className="p-2 bg-indigo-600 rounded-lg text-white"><i data-lucide="layout" className="w-6 h-6"></i></div>
                            <h1 className="font-bold text-xl">视觉创作</h1>
                        </div>

                        <div className="space-y-6">
                            <div>
                                <label className="text-[10px] font-bold text-gray-400 uppercase tracking-widest block mb-2">后端接口地址</label>
                                <input 
                                    type="text" 
                                    className="w-full p-3 bg-gray-50 border rounded-xl text-sm outline-none focus:border-indigo-500"
                                    placeholder="https://..."
                                    value={workerUrl}
                                    onChange={(e) => { setWorkerUrl(e.target.value); localStorage.setItem('worker_url', e.target.value); }}
                                />
                            </div>

                            <button 
                                onClick={generateArtical}
                                disabled={loading}
                                className="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-xl shadow-indigo-100 hover:bg-indigo-700 transition-all disabled:bg-gray-300"
                            >
                                {loading ? '正在绘制图文...' : 'AI 深度创作'}
                            </button>
                        </div>

                        <div className="mt-auto bg-indigo-50 p-4 rounded-xl">
                            <h4 className="text-xs font-bold text-indigo-700 mb-1 flex items-center gap-1">
                                <i data-lucide="info" className="w-3 h-3"></i> 提示
                            </h4>
                            <p className="text-[11px] text-indigo-600/70">图片根据 AI 关键词自动匹配，每次生成都是独一无二的视觉呈现。</p>
                        </div>
                    </div>

                    {/* 手机预览区 */}
                    <div className="flex-1 bg-gray-100 flex items-center justify-center relative p-10 overflow-hidden">
                        <div className="absolute top-8 right-12">
                            <button onClick={handleCopy} className="bg-white px-6 py-3 rounded-full shadow-lg font-bold flex items-center gap-2 hover:scale-105 transition-all">
                                <i data-lucide="clipboard-copy" className="w-5 h-5 text-indigo-600"></i>
                                发布并复制全文
                            </button>
                        </div>

                        <div className="phone-shell flex flex-col">
                            <div className="h-6 w-full flex justify-center mt-2">
                                <div className="w-20 h-4 bg-black rounded-full"></div>
                            </div>
                            <div className="flex-1 overflow-y-auto px-6 py-4 no-scrollbar">
                                <div ref={editorRef} className="wx-article animate-content" contentEditable spellCheck="false">
                                    <div className="h-full flex flex-col items-center justify-center text-gray-300 gap-4 mt-20">
                                        <i data-lucide="image-plus" className="w-12 h-12 opacity-20"></i>
                                        <p className="text-sm">内容生成后将在此处完美呈现</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
